FROM ccr.ccs.tencentyun.com/doowzs/dotnet-core-sdk:3.1
WORKDIR /app

RUN if [ ! -z ${CHANGE_SOURCE} ]; then \
  sed -i 's/deb.debian.org/mirrors.aliyun.com/' /etc/apt/sources.list; \
  sed -i 's/security.debian.org/mirrors.aliyun.com/' /etc/apt/sources.list \
;fi

WORKDIR /src
COPY ./*.sln ./
COPY Data/*.csproj Data/
COPY Notification/*.csproj Notification/
COPY WebApp/*.csproj WebApp/
COPY Worker/*.csproj Worker/
RUN dotnet restore

COPY . ./

