<div class="container my-5" xmlns="http://www.w3.org/1999/html">
  <div *ngIf="reviewId === 0; else review">
    <div class="text-center">
      <h2>
        代码互评部分注意事项
      </h2>
      <br />
      <br />
      <div class="text-left" style="font-size: 15px">
        <p>1， 互评入口将在<strong>通过该道题目</strong>后开启，为了反馈的即时性和有效性，请在通过题目后<strong>立刻进行互评</strong>。</p>

        <p>2， 评分标准为<strong>代码风格、代码可读性等（可自由发挥，需在建议写清理由）</strong>，满分10分。关于风格、可读性建议，请见<a href="https://oj.problemsolving.top/post/notice-2021-1/">此处</a>。</p>

        <p>3， 是否完成互评会计入程序设计部分成绩（提交互评即得分），互评分数不计入成绩</p>

        <p>4， 为了达到良好的学习效果，请每位同学<strong>认真评价，文明用语</strong>。在建议中，推荐模版如下：</p>
        <blockquote>

        <ul><li>优点：（可分点）<ul><li>1.</li><li>2.</li></ul></li><li>缺点：<ul><li>1</li><li>2</li></ul></li></ul>

        </blockquote>
        <p>5，互评时显示的代码，都为已经AC的代码。若你发现互评到的代码有bug，请在建议中指出，并<strong>告诉助教（一定！！）</strong>。若你成功hack，该题可以<strong>以110%的成绩</strong>计入得分，并且我们将构造出能卡掉这份代码的数据，并加入这组数据，重新评测已经通过的所有代码。</p>
      </div>
      <br />
      <br />
      <span class="float-md-none">
      <a *ngIf="errorMessage === null" class="btn btn-sm btn-outline-danger" (click)="GetNext()">
        <fa-icon [icon]="faEdit"></fa-icon><span>开始互评</span>
      </a>
        <div *ngIf="errorMessage !== null" class="alert alert-danger">
          {{errorMessage}}
      </div>
    </span>
    </div>
  </div>
  <ng-template #review>
    <div *ngIf="!!submissions">
      <div *ngFor="let submission of submissions">
         <span *ngIf="reviewId !== reviewMap.get(submission.id)" class="float-lg-left">
            <button class="btn btn-sm btn-outline-primary" (click)="GetReview(reviewMap.get(submission.id))">
          {{reviewMap.get(submission.id)}}
            </button>
         </span>
        <span *ngIf="reviewId === reviewMap.get(submission.id)" class="float-lg-left">
        <button class="turnColor btn btn-sm btn-outline-primary" (click)="GetReview(reviewMap.get(submission.id))">
          {{reviewMap.get(submission.id)}}
        </button>
        </span>
      </div>
      <br/>
      <br/>
      <div *ngFor="let submission of submissions; let i=index">
        <div *ngIf="reviewMap.get(submission.id) === reviewId">
          <h2>代码评分 #{{reviewMap.get(submission.id)}}</h2>
          <div *ngIf="!!submission.program.languageInfo.mode"
               [ngStyle]="{'height':'calc(100vh - 279px)'}">
            <editor [disabled]="true" [submissionId]="submission.id" [program]="submission.program"></editor>
          </div>
        </div>
      </div>
      <br/>
      <br/>
      <form [formGroup]="reviewForm">
        <div formArrayName="scores">
          <div *ngFor="let submission of submissions; let i=index">
            <div *ngIf="reviewMap.get(submission.id) === reviewId">
              <div class="cross-validation"
                   [class.cross-validation-error]="scores.controls[i].invalid && (scores.controls[i].touched || scores.controls[i].dirty)"
                   [class.cross-validation-correct]="!(scores.controls[i].invalid && (scores.controls[i].touched || scores.controls[i].dirty))">
                <p>1，评分
                  <br/>
                  <input class="form-style" style="width: 60px" type="number" min="0" max="10" [formControlName]="i">
                </p>
                <div *ngIf="scores.controls[i].invalid && (scores.controls[i].dirty || scores.controls[i].touched)"
                     class="alert alert-danger">
                  <div *ngIf="scores.controls[i].errors?.required"> 需在此处填写评分</div>
                  <div *ngIf="scores.controls[i].errors?.min || scores.controls[i].errors?.max">填写范围：0～10</div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div formArrayName="comments">
          <div *ngFor="let submission of submissions; let i=index">
            <div *ngIf="reviewMap.get(submission.id) === reviewId">
              <div class="cross-validation"
                   [class.cross-validation-error]="comments.controls[i].invalid && (comments.controls[i].touched || comments.controls[i].dirty)"
                   [class.cross-validation-correct]="!(comments.controls[i].invalid && (comments.controls[i].touched || comments.controls[i].dirty))">
                <p>2，对于这份代码，您有什么建议？（优点、不足等）</p>
                <textarea class="form-style" rows="5" cols="70%" [formControlName]="i"> </textarea>
                <div
                  *ngIf="comments.controls[i].invalid && (comments.controls[i].dirty || comments.controls[i].touched)"
                  class="alert alert-danger">
                  <span *ngIf="comments.controls[i].errors?.required"> 需在此填写建议 </span>
                  <span *ngIf="comments.controls[i].errors?.minlength">请至少填写5个字 </span>
                </div>
              </div>
            </div>
          </div>
        </div>
        <br/>
        <span *ngIf="reviewId !== 1 && reviewId !== submissions.length">
        <button class="float-left btn btn-sm btn-outline-primary" (click)="GetPre()">
          上一份
        </button>
      </span>
        <span *ngIf="reviewId !== submissions.length">
        <button class="float-right btn btn-sm btn-outline-primary" (click)="GetNext()">
          下一份
        </button>
      </span>
        <div *ngIf="reviewId === submissions.length" class="text-center">
          <button type="submit" [disabled]="!reviewForm.valid" (click)="onSubmit()"
                  class="review-submit btn btn-sm btn-outline-primary">
            提交
          </button>
        </div>
      </form>
      <br/>
    </div>
  </ng-template>
</div>
